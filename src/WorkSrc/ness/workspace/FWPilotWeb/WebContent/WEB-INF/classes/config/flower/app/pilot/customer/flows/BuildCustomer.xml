<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root SYSTEM "flower.dtd">
<root>

	<buttonSet name="buildCustomerButtons">
		<button name="save" eventName="save" group="left"/>
		<button name="close" eventName="close" group="left" activityType="readOnly" checkDirtyFlag="true"/>
	</buttonSet>

 	<flow name="buildCustomerFlow" context="pirteyCustomerContext" authId="all">   
 		<state name="initState" initial="true" type="complex" page="app/customer/jsp/pirteyCustomer.jsp" buttonSet="buildCustomerButtons">				 		 	 						
			<subFlowData flowName="customerTabs"/>
			<entryActions>
				<action type="operation" refName="PLInitBuildCustomerOP"/>		
				<action type="operation" refName="ClearDirtyFlagOp"/>
			</entryActions>
			<transition internal="true" event="save" validator="customerValidator">
				<actions>
		        	<action type="operation" refName="PLSaveCustomerOP" />
					<action type="operation" refName="ClearDirtyFlagOp"/>
				</actions>
			</transition>	
			<transition event="close" targetState="finalScreen"/>								   	
  		</state>
 				 		
 		<state name="finalScreen" type="final" /> 		 	
 
 	</flow>
 	 
 	<operationDefinition  name="CustomerValidationOp" class="fwpilot.customer.operations.CustomerValidationOp" />
 	<operationDefinition  name="CustomerValidation2Op" class="fwpilot.customer.operations.CustomerValidation2Op" />
 	
  	<flow name="customerTabs" type="tabSystem">
	  	<tabSystemData page="app/common/jsp/VTabs.jsp"/> 
		<state type="complex" name="general" visible="true" page="app/customer/jsp/customerGeneralDetails.jsp" initial="true">
			<entryActions>
				<action type="operation" refName="ClearDirtyFlagOp"/>
			</entryActions>
			<transition default="true" validator="customerValidator" targetState="DISPATCHER">
				<validationActions>
					<validationAction refName="CustomerValidationOp" stopOnError="true" />
					<validationAction refName="CustomerValidation2Op" />
				</validationActions>
			</transition>
		</state>

		<state type="complex" name="addresses" visible="true">		
			<subFlowData flowName="adressFlow"/>
		</state>
	
		<state type="complex" name="related" visible="true">
			<subFlowData flowName="relatedFlow"/>
		</state>
	</flow>
	
	<flow name="adressFlow">	
		<state name="InitState" type="simple" initial="true">
			<transition targetState="dispatchState" default="true">
				<actions>
			   		<action type="operation" refName="PLInitAddressOP"/>	
					<action type="operation" refName="ClearDirtyFlagOp"/>
			   	</actions>
			 </transition>				
		</state>

		<state name="dispatchState" type="simple">
			<transition targetState="viewState"  default="true">
				<actions>
	                <action type="operation" refName="clickAddress"/>
		        </actions> 
			</transition>
		</state>

		<state name="viewState" type="complex" page="app/customer/jsp/customerAddress.jsp">	
			<transition event="addressTableModel|selection" targetState="dispatchState"/>
	
			<transition event="new" targetState="dispatchState">
				<actions>
	                <action type="operation" refName="PLNewAddressOP" />
		        </actions>
			</transition>
	
			<transition event="delete" targetState="dispatchState">
				<actions>
	                <action type="operation" refName="PLDeleteAddressOP" />
					<action type="operation" refName="SetDirtyFlagOp"/>
		        </actions>
			</transition>
	
			<transition  event="update" targetState="dispatchState" validator="addressDetailsValidator">
				<actions>
		            <action type="operation" refName="PLUpdateAddressOP" />
		        </actions>
			</transition>
		</state>
	</flow>
	
	<flow name="relatedFlow">	
		<state name="InitState" type="simple" initial="true">
			<transition targetState="dispatchState" default="true">
				<actions>
			   		<action type="operation" refName="PLInitRelatedOP"/>	
					<action type="operation" refName="ClearDirtyFlagOp"/>
			   	</actions>
		 </transition>				
		</state>

		<state name="dispatchState" type="simple">
			<transition targetState="viewState"  default="true">
				<actions>
	                <action type="operation" refName="clickRelated"/>
		        </actions> 
			</transition>
		</state>
	
		<state name="viewState" type="complex"  page="app/customer/jsp/customerRelated.jsp">
	
			<transition event="relatedTableModel|selection" targetState="dispatchState"/>

			<transition event="new" targetState="dispatchState">
				<actions>
	                <action type="operation" refName="PLNewRelatedOP" />
		        </actions>
			</transition>
	
			<transition event="delete" targetState="dispatchState">
				<actions>
	                <action type="operation" refName="PLDeleteRelatedOP" />
					<action type="operation" refName="SetDirtyFlagOp"/>
		        </actions>
			</transition>
	
			<transition event="update" validator="relatedValidator" targetState="dispatchState">
				<actions>
		            <action type="operation" refName="PLUpdateRelatedOP" />
		        </actions>
			</transition>			
		</state>
	</flow>
</root>