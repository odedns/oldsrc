<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root SYSTEM "flower.dtd">
<root>	

	<flow name="serachAgreementFlow" context="searchAgreementCTX" menu="agreementMenu">	
		<state name="initState" type="simple" initial="true">
			<transition default="true" targetState="viewState">
				<actions>
			   		<action type="operation" refName="PLInitSearchAgreementOP"/>
					<action type="operation" refName="ClearDirtyFlagOp"/>
				</actions>					
			</transition>
 		</state> 
 		
		<state name="viewState" type="complex" page="app/agreement/jsp/searchAgreement.jsp" buttonSet="searchHeskemButtons,pagingBS">				
			
			<actionList name="searchAL">
                <action type="operation" refName="PLFillAgreementSearchResultsOP"/>
				<action refName="SetButtonsPagingState" type="operation"></action>
			</actionList>
			
			<transition internal="true" event="search">
				<actions>
					<action type="actionList" refName="searchAL" />
		        </actions>
		    </transition>
	
			<transition event="searchResultTableModel|sort" internal="true"/>
			<transition event="searchResultTableModel|order" internal="true"/>

			<transition event="searchResultTableModel|link1" targetState="agreementDetailsState" outFormatter="agreementUpdateModeFMT">
				<actions>
					<action type="operation" refName="PLGetMenuAgreementIdOP"></action>
				</actions>
			</transition>
	
			<transition event="searchResultTableModel|link2" targetState="agreementDetailsState" outFormatter="agreementCopyModeFMT">
				<actions>
					<action type="operation" refName="PLGetMenuAgreementIdOP"></action>
				</actions>
			</transition>
	
			<transition internal="true" event="clearFields">
				<actions>
					<action type="operation" refName="PLClearAgreementCriteriaOP"></action>
				</actions>
			</transition> 
										
	 		<transition event="searchResultTableModel|link" targetState="agreementDetailsState" outFormatter="agreementUpdateModeFMT">
	 			<actions>
					<action type="operation" refName="PLGetLinkAgreementIdOP"></action>
				</actions>	 			
	 		</transition>
	
			<!-- start handling paging -->
			<transition event="first" internal="true">
				<actions>
					<action refName="PLGetAgreementsPage" type="operation">
						<param name="operationType" class="java.lang.Integer" value="0"/>
					</action>
					<action refName="SetButtonsPagingState" type="operation"></action>
				</actions>
			</transition>
			
			<transition event="last" internal="true">
				<actions>
					<action refName="PLGetAgreementsPage" type="operation">
						<param name="operationType" class="java.lang.Integer" value="1"/>
					</action>
					<action refName="SetButtonsPagingState" type="operation"></action>
				</actions>
			</transition>
			
			<transition event="next" internal="true">
				<actions>
					<action refName="PLGetAgreementsPage" type="operation">
						<param name="operationType" class="java.lang.Integer" value="2"/>
					</action>
					<action refName="SetButtonsPagingState" type="operation"/>
				</actions>
			</transition>
						
			<transition event="prev" internal="true">
				<actions>
					<action refName="PLGetAgreementsPage" type="operation">
						<param name="operationType" class="java.lang.Integer" value="3"/>
					</action>
					<action refName="SetButtonsPagingState" type="operation"/>
				</actions>
			</transition>		
			<!-- end handling paging -->

			<transition event="new" targetState="agreementDetailsState" outFormatter="agreementNewModeFMT"/>
			<transition event="delete" targetState="viewState" >
				<actions>
					<action type="operation" refName="deleteAgreementOp"/>
					<action type="actionList" refName="searchAL" />
				</actions>
			</transition>
			<transition event="close" targetState="finalScreen"/>										
		</state>
		
		<state name="agreementDetailsState" type="complex">
			<subFlowData flowName="buildAgreementFlow" inFormatter="agreementIdFMT"/>		
				<transition event="finalScreen" targetState="viewState"></transition>							
		</state>  
				
		<state name="finalScreen" type="final" />	
	</flow>
	
	<operationDefinition name="deleteAgreementOp" class="fwpilot.agreement.operations.PLDeleteAgreementOP"/>
	
</root>