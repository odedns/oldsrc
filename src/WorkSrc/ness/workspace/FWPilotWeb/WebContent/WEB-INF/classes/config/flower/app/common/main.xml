<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root SYSTEM "flower.dtd">
<root>


	<buttonSet name="desktopButtons">
		<button name="do" eventName="do" group="left"/>
		<button name="send" eventName="send" group="left"/>
		<button name="dial" eventName="dial" group="left"/>
		<button name="map" eventName="map" group="left"/>
		<button name="refresh" eventName="refresh" group="left"/>
		<button name="sort" eventName="sort" group="left"/>
	</buttonSet>


	<!-- =========================================== -->
	<!-- The root context for the whole application  -->
	<!-- =========================================== -->

	<context name="applicationContext" type="static"/>

	<context name="menuContext">
	</context>

	<context name="mainFlowContext" parent="applicationContext">
		<field name="userId" type="string"/>
		<field name="inputUserId" type="xiString"/>
		<field name="password" type="xiString"/>
		<field name="currentDate" type="xiDate" childAccess="full" />
		<field name="queueTableModel" type="tableModel" childAccess="full"/>
		<field name="leftToolBar" type="toolbarModel" childAccess="full"/>
		<field name="rightToolBar" type="toolbarModel" childAccess="full"/>
		<field name="pagingToolBar" type="toolbarModel" childAccess="full"/>
		<field name="messagesModel" type="messagesModel" childAccess="full"/>
		<field name="dirtyFlagModel" type="dirtyModel" childAccess="full"/>
		<field name="eventFromMenu" type="boolean" defaultValue="true"/>


		<!-- TODO: temporary due 2 known bug -->
		<field name="f1" type="xiString" childAccess="full"/>
		<field name="f2" type="xiString" childAccess="full"/>

	</context>

	<flow name="mainFlow" context="mainFlowContext" type="generic" >
		<state name="initState" type="simple" initial="true">
			<entryActions>
				<action type="operation" refName="init"/>
			</entryActions>
			<transition default="true" targetState="mainScreen">
				<subFlowData flowName="menuFlow" outFormatter="menuEventFRM"/>
			</transition>
		</state>
		

	<!--	<state name="loginPage" type="complex" initial="true" page="app/common/jsp/login.jsp">
			<transition event="login" targetState="mainScreen" outFormatter="loginFormatter">
				<actions>
					<action type="operation" refName="init"/>
				</actions>
				<subFlowData flowName="menuFlow" />
			</transition>
		</state> -->

		<state name="mainScreen" type="complex" waitingForEvent="true">
			<transition internal="true" default="true" traverseEvent="true" outFormatter="nonMenuEventFRM">
				<subFlowData flowName="menuFlow" />
			</transition>
			<transition event="finalOK" targetState="loginPage" />
		</state>
	</flow>


	<flow name="menuFlow" context="menuContext" menu="systemMenu,systemMenu2" independent="true" implementation="menuFlow">	
		<state name="init" type="simple" initial="true">

			<transition guard="ctx.getBoolean('eventFromMenu').booleanValue() == true" targetState="mainScreen"> 
				<subFlowData flowName="desktopFlow"/>  
			</transition>

			<transition guard="ctx.getBoolean('eventFromMenu').booleanValue() == false" targetState="mainScreen"> 
			</transition>

	<!--		<transition guard="true" targetState="mainScreen">
				<subFlowData flowName="desktopFlow"/>  
			</transition> -->
			
		</state>

		<state name="mainScreen" type="complex" page="app/common/jsp/mainScreen.jsp">		
			<transition event="finalScreen" internal="true">
				<subFlowData flowName="desktopFlow"></subFlowData>
			</transition>
		</state>

		<state name="finalOK" type="final" />

	</flow>

	<flow name="menuNormalFlow">
		<state name="viewState" type="complex" initial="true" 
			page="app/common/jsp/menuNormalFlow.jsp" />
	</flow>

	<flow name="menuIndependentFlow" independent="true">
		<state name="viewState" type="complex" initial="true" 
			page="app/common/jsp/menuIndependentFlow.jsp" />
	</flow>
	
	<flow name="desktopFlow" type="tabSystem">
		<tabSystemData page="app/common/jsp/VTabs.jsp"/>

		<state name="manager" type="complex" visible="true" page="app/general/jsp/queue.jsp" initial="true" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initManagerDesktop"></action>
			</entryActions>

			<transition event="do" internal="true">
				<actions>
					<action type="operation" refName="CheckLegacy"></action>
				</actions>
			</transition>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>			
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>		
			<transition event="queueTableModel|order" internal="true"/>		
		</state>
		
		<state name="hafaka" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initProductionDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTable|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		
		</state>


		<state name="changes" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initChangesDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		
		</state>

		<state name="approval" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initApprovalDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		
		</state>

		<state name="postponed" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initRejectedDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		

		</state>

		<state name="docs" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">
			<entryActions>
				<action type="operation" refName="initDocumentsDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		
		</state>
		
		<state name="allMissions" type="complex" visible="true" page="app/general/jsp/queue.jsp" buttonSet="desktopButtons">		
			<entryActions>
				<action type="operation" refName="initAllDesktop"></action>
			</entryActions>

			<transition event="do" internal="true"/>
			<transition event="send" internal="true"/>
			<transition event="dial" internal="true"/>
			<transition event="map" internal="true"/>
			<transition event="refresh" internal="true"/>
			<transition event="sort" internal="true"/>
			<transition event="queueTableModel|TableEvent" internal="true"/>			
			<transition event="queueTableModel|link1" internal="true"/>			
			<transition event="queueTableModel|link2" internal="true"/>			
			<transition event="queueTableModel|link3" internal="true"/>			
			<transition event="queueTableModel|link4" internal="true"/>			
			<transition event="queueTableModel|sort" internal="true"/>
			<transition event="queueTableModel|order" internal="true"/>		
		</state>

	</flow> 
	 	
</root>