<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root SYSTEM "flower.dtd">
<root>
	
	<context name="searchCustomerFromAgreementContext">	

		<!-- search fields -->
		<field name="searchResultTableModel" type="tableModel"  />
		<field name="customerTypeModel" type="listModel" />
		<field name="id" type="xiString"  />
		<field name="firstName" type="xiString"  />
		<field name="telephone" type="xiString"  />
		<field name="city" type="xiString"  />

		<!-- seleced id from table-->
		<field name="custID" type="integer"  />		

		<!-- selected customer type -->
		<field name="selectedCustomerTypeModel" type="listModel"  />

		<!-- ??? check if necesssary -->
		<field name="customerId" type="integer" childAccess="full"/>
		<field name="customerName" type="string" childAccess="full"/>			

	</context>

	<formatterDefinition name="validateCustomerFormatter2" type="simple">
		<format fromName="id" toName="id"/>
	</formatterDefinition>


	<flow name="searchCustomerFromAgreementFlow" context="searchCustomerFromAgreementContext" independent="true">	
		<state name="initWindow" type="simple" initial="true">
			<transition  default="true" targetState="openWindow" alternativeTargetState="openError">
				<actions>
			   		<action type="operation" refName="initSearchCustomerFromAgreement"/>
			   		<action type="operation" refName="validateCustomer" inFormatter="validateCustomerFormatter2"/>
	                <action type="operation" refName="fillCustomerFromAgreementSearchResults"/>
				</actions>					
			</transition>
 		</state> 
 
 		
		<state name="openWindow" type="complex" page="app/agreement/jsp/searchCustomerFromAgreement.jsp">			
			<transition internal="true" event="search">
				<actions>
	  		   		<action type="operation" refName="validateCustomer" inFormatter="validateCustomerFormatter2"/>
                    <action type="operation" refName="fillCustomerFromAgreementSearchResults"/>
		        </actions>
		    </transition>	

			<transition internal="true" event="clearFields">
				<actions>
					<action type="operation" refName="clearSearchCustomerFields"></action>
				</actions>
			</transition> 					
			
			<transition event="close" targetState="finalScreen"></transition>							
			
		</state>
		

		<state name="openError" type="complex" page="app/agreement/jsp/searchCustomerFromAgreement.jsp">			
	
			<transition event="search" targetState="initWindow">
		<!--		<actions>
                    <action type="operation" refName="fillCustomerSearchResults"/>
		        </actions>  -->
		    </transition>	

			<transition internal="true" event="clearFields">
				<actions>
					<action type="operation" refName="clearSearchCustomerFields"></action>
				</actions>
			</transition> 					
			
			<transition event="close" targetState="finalScreen"></transition>							
			
		</state>


		<state name="finalScreen" type="final" />
					
	</flow>
		
	<formatterDefinition name="fillResultFormatter" type="simple">
		<format fromName="city" toName="city" />
		<format fromName="firstName" toName="firstName" />
		<format fromName="telephone" toName="telephone" />
		<format fromName="id" toName="id" />
	</formatterDefinition>
	
</root>